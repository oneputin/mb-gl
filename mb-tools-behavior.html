<link rel="import" href="../polymer/polymer.html">

<script>
    Polymer.ToolsBehaviorImpl = {

        properties: {},

        // derive comparable/calculable times
        // from dates of type "2016.12.11,16.00" or "2016.12.16,16:00"
        utcTime: function(t, lonlat, unit) {
            // !! for parser the MONTH must be numbered 0 .. 11 !!
            var tlocal;
            if (typeof t == "string") {
                var t = t.replace(",", "."),
                    t = t.replace(":", "."),
                    a = t.split(".");
                if (a.length > 5) {
                    tlocal = new Date(parseInt(a[0]), parseInt(a[1]) - 1, parseInt(a[2]), parseInt(a[3]), parseInt(a[4]), parseInt(a[5]));
                } else {
                    tlocal = new Date(parseInt(a[0]), parseInt(a[1]) - 1, parseInt(a[2]), parseInt(a[3]), parseInt(a[4]));
                }
            } else {
                tlocal = t;
            }

            var tg = tlocal,
                tunit = tg;

            if (unit == "h") tunit = tg / (1000 * 3600);
            else if (unit == "s") tunit = tg / 1000;
            else tunit = tg;

            return tunit;
        },

        // Create readable time period h:min
        deltaT: function(t, fallback) {
            var h = Math.floor(t),
                m = Math.round((t - h) * 60);
            if (h > 0) h = h < 10 ? "0" + h + "h" : h + "h";
            else h = "";
            m = (m < 10) ? "0" + m : m;
            return h || m ? h + m + "min" : fallback;
        },

        logTime: function(ms1970, sep) {
            if (!sep) sep = ", ";
            var logtime = new Date(ms1970);
            //  logtime = logtime.getDate() + "." + (logtime.getMonth() + 1) + ", " + logtime.getHours() + ":" + logtime.getMinutes();
            //  console.log(ms1970, logtime);

            var D = logtime.getDate(),
                D = D < 10 ? "0" + D : D,
                M = logtime.getMonth() + 1,
                M = M < 10 ? "0" + M : M,
                h = logtime.getHours(),
                h = h < 10 ? "0" + h : h,
                m = logtime.getMinutes(),
                m = m < 10 ? "0" + m : m;

            logtime = D + "." + M + sep + h + ":" + m;
            return logtime;
        },

        featureBounds: function(features, map) {

            if (features.features) features = features.features; //console.log(data); // return
            if (!features.length) return; //console.log(features); 
            // console.log("1-bounddata(features)", features);

            // Transform into list of coordinate-lists
            var coordinates = [], segments, coords, pnt, latitude, longitude, bb = {};
            
            for (var i = 0; i < features.length; i++) {
                t = features[i].geometry.type;
                segments = features[i].geometry.coordinates;
                if (t=="LineString") {
                    coordinates = coordinates.concat(segments);
                } else if (t=="MultiLineString") {
                    for (var j = 0; j < segments.length; j++) {
                        coordinates = coordinates.concat(segments[j]);
                    }    
                }
            }
            //console.log("2-coordinates",coordinates);

            // Pass the first coordinates to `lngLatBounds` 
            // & wrap each coordinate pair in `extend` to include them in the bounds result. 
            var bounds = coordinates.reduce(function(bounds, coord) {
                return bounds.extend(coord);
            }, new mapboxgl.LngLatBounds(coordinates[0], coordinates[0]));
            //console.log("3-totalbounds", bounds);

            if (!map) return bounds;

            map.fitBounds(bounds, {
                padding: 20
            });
        },

        getRandomColor: function() {
            var letters = '0123456789ABCDEF';
            var color = '#';
            for (var i = 0; i < 6; i++ ) {
                color += letters[Math.floor(Math.random() * 16)];
            }
            return color;
        }
    };

    /** @polymerBehavior */
    Polymer.ToolsBehavior = [
        Polymer.ToolsBehaviorImpl
    ];
</script>