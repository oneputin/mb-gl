<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../paper-icon-button/paper-icon-button.html">
<link rel="import" href="../paper-slider/paper-slider.html">
<link rel="import" href="../paper-material/paper-material.html">

<link rel="import" href="../iron-flex-layout/iron-flex-layout.html">

<link rel="import" href="mb-behavior-routes.html">
<link rel="import" href="icons-svg.html">

<!--
`mb-routes-ctrl`
ctrl elements controling behavior of animated objects in map  
some ctrls (back,forward...) and "slider" are "redundant and should be used exclusively 

@demo demo/routemap.html 
-->

<dom-module id="mb-routes-ctrl">

    <template>
    
    	<style type="text/css">
        
	        .ctrlbox {
                @apply(--layout-horizontal);
                @apply(--layout-center);
	        }
            
            paper-icon-button.blue {
                --paper-icon-button-ink-color: var(--paper-orange-500);
                background-color: var(--paper-light-blue-500);
                color: white;
                border-radius: 3px;
                padding: 2px;
                margin: 5px; 
            }

            paper-icon-button.trans {
                color: var(--paper-light-blue-500);
                margin: 1px; 
            }

            #trace {
                @apply(--layout-flex);
                border-style: solid;
                border-width: 1px;
                margin: 5px;
                --paper-slider-height: 5px;
            }

            #logtime {
                margin: 5px;
                padding: 5px;
                background-color: var(--paper-light-blue-500);
                color: white;
            }

    	</style>
	
		<div class="ctrlbox"> 
            
            <!--<paper-icon-button id="replay" icon="{{_icon1}}" title="restart" class="blue"></paper-icon-button>-->
            
            <paper-icon-button id="slowdown" icon="{{_icon_remove}}" title="slowdown" class="trans"></paper-icon-button>
            <paper-icon-button id="toggle" icon="{{_icon2}}" title="startstop" class="blue"></paper-icon-button>
            <paper-icon-button id="speedup" icon="{{_icon_add}}" title="speedup" class="trans"></paper-icon-button>
            
            <paper-slider id="trace" value="{{sliderval}}" immediate-value="{{slidertime}}" min="{{start}}" max='{{stop}}' on-immediate-value-change="slideChangeHandler" pin></paper-slider>
            <!-- on-value-change="slideValueHandler" -->
           
            <paper-material elevation="2" id="logtime">{{logtime}}</paper-material>

	    </div>

    </template>

    <script>
        Polymer({
            is: 'mb-routes-ctrl',

            properties: {
                /**
                 * Animation status
                 */
                trackctrl: {
                    type: Boolean,
                    value: false,
                    notify: true
                },

                timer: {
                    type: Object,
                    value: {}
                },

                start: {
                    type: Number
                },

                stop: {
                    type: Number
                },

                fromtimertime: {
                    type: Number,

                },

                slidertime: {
                    type: Number
                },

                _icon1: {
                    type: String,
                    value: "ctrl:skip-previous"
                },

                _icon2: {
                    type: String,
                    value: "ctrl:play-arrow"
                },

                _icon_add: {
                    type: String,
                    value: "ctrl:add-circle-outline"
                },

                _icon_remove: {
                    type: String,
                    value: "ctrl:remove-circle-outline"
                },

            },

            behaviors: [
                Polymer.BehaviorRoutes,
            ],

            listeners: {
                // for value-sliders
                //'change': 'changeHandler'
            },

            observers: [
                'controlupdate(trackctrl)',
                'sliderinit(timer.stop)', // , timer.stop)',
                'sliderupdate(timer.time)'
            ],

            ready: function() {
                this.setupAnimationCtrls();
            },

            controlupdate: function(trackctrl, trackmode) {
                // ctrls must reflect the handling options during actual status 
                if (trackctrl) {
                    if (trackctrl == "reset") {
                        this._icon2 = "ctrl:play-arrow";
                    } else {
                        this._icon2 = "ctrl:pause";
                    }
                } else {
                    this._icon2 = "ctrl:play-arrow";
                }

            },

            sliderinit: function(stoptime) { // , stoptime) {
                if (!stoptime) return;
                var starttime = this.timer.start;
                console.log("Setup timeslider from start-/stop-times ", starttime, stoptime);

                var deltat = Math.round(stoptime - starttime);
                this.start = 0;
                this.stop = deltat + 1;
            },

            sliderupdate: function(tracktime) {
                if (!tracktime) return;
                // Sync the slider with externally modified tracktime 
                this.sliderval = tracktime - this.timer.start;
                // Display readable tracktime  
                var logtime = this.logTime(tracktime * 3600 * 1000, "<br>");
                this.$.logtime.innerHTML = logtime;
            },



            // Sync slider with external changes of slided parameter 
            // fi. due to animation 
            slideValueSync: function() {
                var slidervalue = this.timer.start - this.timer.time;
                // console.log("slided time", mapTime);
                this.trackctrl = mapTime; // 
            },

            // 
            slideValueHandler: function(val) {
                console.log("slide-val=", val);
            },


            // Communicate the app-parameter connected to slider-value 
            // via ctrl-parameter "trackctrl"
            slideChangeHandler: function() {
                var mapTime = this.timer.start + this.slidertime;
                // var mapTime = this.start + this.slidertime;
                // console.log("slided time", mapTime);
                this.trackctrl = mapTime; // 
            },

            /**
             * Setup the Ctrl-actions (start/stop, restart, time-slider) 
             *
             */
            setupAnimationCtrls: function() {

                this.val = 1;

                var ctrl1 = this.$.replay,
                    ctrl2 = this.$.toggle,
                    ctrl3a = this.$.slowdown,
                    ctrl3b = this.$.speedup;

                var tracer = this.$.trace,
                    tracetime;

                if (ctrl1) {
                    // ReStart-Button-event
                    ctrl1.addEventListener('click', function() {
                        this.trackctrl = "reset";
                    }.bind(this));
                }

                if (ctrl2) {
                    // Start/Stop-Button-event
                    ctrl2.addEventListener('click', function() {
                        // console.log("clicked at:" + this.trackctrl, ctrl2.childNodes);
                        if (this.trackctrl) {
                            this.trackctrl = false;
                        } else {
                            this.trackctrl = true;
                        }
                    }.bind(this));
                }

                if (ctrl3a) {
                    // Slowdown/speedup animation
                    ctrl3a.addEventListener('click', function() {
                        console.log("slowdown");
                        // this.trackctrl = "reset";
                    }.bind(this));
                    ctrl3b.addEventListener('click', function() {
                        console.log("speedup");
                        // this.trackctrl = "reset";
                    }.bind(this));
                }



            }

        });
    </script>

</dom-module>

</dom-module>