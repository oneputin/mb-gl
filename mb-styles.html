<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="dynamic-menu.html">

<!--
`mb-styles`  
selects and applies a style to actual map

@demo demo/routingplanes.html 
-->
<dom-module id="mb-styles">

    <template>
        <style>
            :host {
                display: block;
                position: absolute;
                z-index: 9;
                top: 0;
                
                left: 50%;
                margin-right: -50%;
                transform: translate(-50%, 0);

                font: 0.8em Courier, Lucida;
                background-color: rgba(255,64,129,0.8); /*#ff4081*/
                color: white;                    
            }
        </style>

        <dynamic-menu
            menudata="{{styles}}"
            menulabel="MapStyles"
            selectprop="id"
            selectvalue="{{styleid}}">
        </dynamic-menu>

    </template>

    <script>

        Polymer({
            is: 'mb-styles',

            properties : {
                map: {
                    type: Object,
                    notify: true,
                    observer: 'setupTool'
                },

                // 
                mbversion: {
                    type: String,
                    value: '-v9'
                },

                styles: {
                    type: Array
                },

                styleid : {
                    type: String,
                    notify: true,
                    observer: 'switchStyle'
                },

                checked: {
                    type: Boolean,
                    value: true,
                    observer: 'toggleTool'
                }

            },

            attached : function(){

                this.styles = [
                    {
                        id: "ciuz8mtxy01dx2jl8mszelrkm",
                        title: "myLight",
                        user: "oneputin"
                    },
                    {
                        id: "ciuv91dl2013z2iqq0y2z7ezg",
                        title: "myBunt",
                        user: "oneputin"
                    },
                    {
                        id: "basic",
                        title: "basic"
                    },
                    {
                        id: "streets",
                        title: "streets"
                    },
                    {
                        id: "bright",
                        title: "bright"
                    },
                    {
                        id: "light",
                        title: "light"
                    },
                    {
                        id: "satellite",
                        title: "satellite"
                    },
                ];

                if (!this.checked) this.toggleTool(false);
            },

            // 
            switchStyle: function(styleid) {
                if (!this.map) return;  

                console.log("stylesheet before switching", this.map.style.stylesheet); 

                var url,
                    mbversion = this.mbversion ;

                this.styles.some(function(s){
                    if (s.id == styleid) {
                        if (s.user) {
                            url = 'mapbox://styles/' + s.user +'/' + styleid ;
                        } else {
                            url = 'mapbox://styles/mapbox/' + styleid + mbversion;
                        }    
                        return true;
                    } 
                }); 
                if (url) {
                    console.log("switching style", styleid, url);
                    this.map.setStyle(url);
                }    
            },

            setupTool: function(){
                if (!this.map) return;
                this.toggleTool();
            },

            toggleTool: function(checked) {
                if (!this.map) return;

                if (checked==null) checked = this.checked;
                console.log("checked", checked);
                if (checked) {
                    this.style.display = "block";
                } else {
                    this.style.display = "none";
                }
            },


        });
    </script>

</dom-module>
