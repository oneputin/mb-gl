<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="mb-api.html">
<link rel="import" href="mb-map-behavior.html">

<!--
`mb-location-log`
wraps a distance utility 

@demo demo/routingtracks.html 
-->

<dom-module id="mb-location-log">
    <template>
        <style>
            :host {
                display: block;
                position: absolute;
                z-index: 9;
                bottom: 0%;
                height: 1.5em;
               
                /*left: 0%;*/
                left: 50%;
                margin-right: -50%;
                transform: translate(-50%, 0);

                font: 0.8em Courier, Lucida;
                background-color: rgba(255,64,129,0.8); /*#ff4081*/
                color: white;                    
                /*opacity: 0.7;*/ /*related to all content bg,fg*/
            }

            #innerarea {
                padding: 0.2em;
            }
        </style>

        <div id="innerarea">[[info]]</div>

    </template>

    <script>
        var logscope; // required to enable variable log-events (mapmove or mouse)

        Polymer({

            is: 'mb-location-log',

            properties: {
                /**
                 *  map-object of related mb-gl-map
                 */
                map: {
                    type: Object,
                    observer: 'setupTool'
                },

                /**
                 * LonLat in csv-format
                 */
                lnglat: {
                    type: String,
                    notify: true
                },

                srcmode: {
                    type: String,
                    value: "mouse"
                },
                /**
                 * creating with formatter from mb-tools
                 */
                info: {
                    type: String,
                    computed: 'formatlonlat(lnglat)'
                },

                checked: {
                    type: Boolean,
                    value: true,
                    observer: "toggleTool"
                }
            },

            behaviors: [
                Mbb.MapBehavior,
            ],

            observers: [],

            attached: function() {
                logscope = this;  //console.log("logscope", logscope);
                if (!logscope.checked) logscope.toggleTool(false);
            },

            // 
            toggleTool: function(checked) {
                if (!this.map) return;
                var msg = "move-event toggled " + checked ; // console.log(msg, "srcmode=", this.srcmode);
                if (checked) {
                    
                    this.style.display = "block";

                    if (this.srcmode == "mouse") {
                        this.map.on('mousemove', this.onMoveEvent);
                    } else if (this.srcmode == "mapcenter") {
                        this.map.on('move', this.onMoveEvent);
                    }

                } else {
                    
                    this.style.display = "none";

                    if (this.srcmode == "mouse") { // 
                        this.map.off('mousemove', this.onMoveEvent);
                    } else if (this.srcmode == "mapcenter") {
                        this.map.off('move', this.onMoveEvent);
                    }
                }
            },

            // 
            onMoveEvent: function(e) {
                if (logscope.srcmode == "mapcenter") logscope.lnglat = logscope.map.getCenter();
                else logscope.lnglat = e.lngLat;
                // console.log("MOVE-Event", e, logscope.lnglat);
            },

            // 
            setupTool: function(map) {
                // if (!this.map) return;
                if (this.checked && this.map) {
                    if (this.srcmode == "mouse") this.map.on('mousemove', this.onMoveEvent);
                    else if (this.srcmode == "mapcenter") this.map.on('move', this.onMoveEvent);
                }
            },

        });
    </script>
</dom-module>