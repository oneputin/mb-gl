<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="mb-api.html">
<link rel="import" href="mb-map-behavior.html">

<!--
`mb-location-log`
wraps a distance utility 

@demo demo/routingtracks.html 
-->

<dom-module id="mb-location-log">
    <template>
        <style>
            :host {
                display: block;
                position: absolute;
                z-index: 9;
                bottom: 0%;
                height: 1.5em;
               
                /*left: 0%;*/
                left: 50%;
                margin-right: -50%;
                transform: translate(-50%, 0);

                font: 0.8em Courier, Lucida;
                background-color: rgba(255,64,129,0.8); /*#ff4081*/
                color: white;                    
                /*opacity: 0.7;*/ /*related to all content bg,fg*/
            }

            #innerarea {
                padding: 0.2em;
            }
        </style>

        <div id="innerarea">[[info]]</div>

    </template>

    <script>
        var logscope; // required to enable variable log-events (mapmove or mouse)

        Polymer({

            is: 'mb-location-log',

            properties: {
                /**
                 *  map-object of related mb-gl-map
                 */
                map: {
                    type: Object,
                    observer: 'setupTool'
                },

                /**
                 * LonLat in csv-format
                 */
                lnglat: {
                    type: String,
                    notify: true
                },

                mousemode: {
                    type: Boolean,
                    value : false
                },
                /**
                 * creating with formatter from mb-tools
                 */
                info: {
                    type: String,
                    computed: 'formatlonlat(lnglat)'
                },

                checked: {
                    type: Boolean,
                    value: true,
                    observer: "toggleVisibility"
                }
            },

            behaviors: [
                Mbb.MapBehavior,
            ],

            observers: [
                'toggleMode(mousemode, checked)'
            ],

            attached: function() {
                if (typeof this.checked == 'undefined') this.toggleVisibility(true);
                logscope = this;  //console.log("logscope", logscope);
            },

            // 
            toggleVisibility: function(checked) {
                if (!this.map) return;
                if (checked) {
                    this.style.display = "block";                    
                } else {   // console.log("toggleVisibility NONE");  
                    this.style.display = "none";
                }
            },
            // 
            toggleMode : function(mousemode, checked) {
                if (!this.map) return; 

                // 1. always set (previous) events OFF (if existing) 
                this.map.off('move', this.onMoveEvent);
                this.map.off('mousemove', this.onMoveEvent);

                // 2. set ON specific event only if log-element is checked TRUE
                if (checked) {
                    if (mousemode) {
                        this.map.on('mousemove', this.onMoveEvent);
                    } else {
                        this.map.on('move', this.onMoveEvent);
                    }
                } 
            },

            // derive location-info from mouse or map-center
            onMoveEvent: function(e) {
                if (logscope.mousemode) {
                    logscope.lnglat = e.lngLat;
                } else {
                    logscope.lnglat = logscope.map.getCenter();
                } 
            },

            // 
            setupTool: function(map) {
                if (map) { // console.log("FIRST locationLogMode" , this.mousemode);
                    this.toggleMode(this.mousemode, this.checked); 
                    this.lnglat = this.map.getCenter(); // INITIAL location
                }
            },

        });
    </script>
</dom-module>