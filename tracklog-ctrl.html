<link rel="import" href="../polymer/polymer.html">

<link rel="import" href="mb-map-behavior.html">
<link rel="import" href="tracks-behavior.html">

<link rel="import" href="../iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="dynamic-menu.html">

<!--
`tracklog-ctrl`
presentation of of a track's points   
in interactive ctrl components enabling detailed /information selection 
- menues
- sliders  

@demo demo/routingtracks.html 
-->

<dom-module id="tracklog-ctrl">

    <template>

        <style>
            :host {
                display: block;
                position: absolute;
                width: 400px;
                /*height: 600px;*/
            }
            .vertical {
                @apply(--layout-vertical);
            }
            .horizontal {
                @apply(--layout-horizontal);
            }
            .flexchild {
                @apply(--layout-flex);
            }

            dynamic-menu {
               background-color: var(--paper-grey-300);
            }
        </style>

        <!--<div class="vertical">
            <div class="flexchild">-->
                <dynamic-menu 
                    class = "metadata"
                    menulabel = "TrackPoint"
                    menuitems = "[[zitems]]"
                    selectitem = "{{zitem}}">
                </dynamic-menu>
        <!--</div>
        </div>-->
    </template>

    <script>
        
        Polymer({
            is: 'tracklog-ctrl',

            properties: {

                metadata: {
                    type: Object
                },


                logdata : {
                    type: Object,
                    observer: 'logMenuCreate'
                },

                // 
                logindex: {
                    type: Number,
                    observer: 'logMenuSetSelection',
                    notify: true
                },

                zitems : {
                    type: Array
                },

                zitem: {
                    type: Object,
                    observer: 'logMenuGetSelection' 
                },

                visible: {
                    type: Boolean,
                    value: true,
                    observer: "toggleVisibility"
                }
            },

            behaviors: [
                Mbb.TracksBehavior,
                Mbb.MapBehavior
            ],                

            observers: [
            ],

            // Refresh parameters of chart-element <google-chart>
            logMenuCreate: function(logdata){
                var scope = this,
                    times = logdata["coordTimes"],
                    elevs = logdata["coordElevs"];
                
                if (!times || !elevs || !times.length || !elevs.length) {
                    console.log("Supplied log-data incomplete!", logdata); 
                    this.zitems = [];
                    return;
                }   // console.log("Refresh CtrlElem", times, elevs); 

                // A. Create MenuItems  
                var zitems = [], zitem;
                var sp = String.fromCharCode(160), // &nbsp;
                    delim = sp + sp,
                    zeit, utc; //  +sp ;

                times.forEach(function(t, j){
                    utc = scope.utcTime(scope.trackTime(t), "h");
                    zeit = scope.logTime(utc,"h","t"); // +":"+scope.logTime(utc,"h","m");
                    zitem = {
                        "id" : j,
                        "title" : zeit + delim + elevs[j] + "[m]",
                        "utctime" : utc,
                        "elevation": elevs[j]
                    }
                    zitems.push(zitem);
                })
                this.zitems = zitems; 
            },  
            
            //
            logMenuSetSelection: function(logindex){
                if (!this.zitems) return; 
                this.zitem = this.zitems[logindex];
            },

            // 
            logMenuGetSelection: function(menuitem){// console.log("logMenuGetSelection", menuitem.id, menuitem);
                if (!menuitem) return;  
                this.logindex = menuitem.id;
            },
            
            // 
            toggleVisibility: function(visible) {
                if (visible) {
                    this.style.display = "block";
                } else {
                    this.style.display = "none";
                }
            },    

        });
    </script>
</dom-module>