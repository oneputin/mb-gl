<!doctype html>
<html>

<head>
    <title>mb-routes demo</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1, user-scalable=yes">
    <script src="../../webcomponentsjs/webcomponents-lite.js"></script>

    <link rel="import" href="../../iron-demo-helpers/demo-pages-shared-styles.html">
    <link rel="import" href="../../iron-demo-helpers/demo-snippet.html">
    <link rel="import" href="../../iron-flex-layout/iron-flex-layout.html">

    <link rel="import" href="../../paper-item/paper-item.html">
    <link rel="import" href="../../paper-listbox/paper-listbox.html">
    <link rel="import" href="../../paper-dropdown-menu/paper-dropdown-menu.html">

    <link rel="import" href="../mb-map.html">
    <link rel="import" href="../mb-routes.html">
    <link rel="import" href="../mb-routes-ctrl.html">
    <link rel="import" href="../mb-routes-ctrl-mode.html">
    <link rel="import" href="../mb-routes-ctrl-time.html">

    <link rel="import" href="../mb-info.html">

    <link rel="import" href="../../paper-styles/demo-pages.html">

    <style is="custom-style">
        mb-info {
            left: 50%;
            margin-right: -50%;
            transform: translate(-50%, 0)
        }
        
        paper-dropdown-menu {
            position: absolute;
            background-color: var(--paper-light-green-500);
            opacity: 0.8;
            padding: 10px;
            top: 40px;
            left: 30px;
        }
        
        mb-routes-ctrl-mode {
            position: absolute;
            bottom: 10px;
            right: 10px;
        }
        
        mb-routes-ctrl {
            position: absolute;
            bottom: 10px;
            left: 30px;
        }
        
        mb-routes-ctrl-time {
            position: absolute;
            top: 40px;
            right: 20px;
        }
    </style>

</head>

<body>

    <template is="dom-bind" id="app">

        <iron-ajax
            auto
            url="[[setupurl]]"
            handle-as="json"
            on-response="setupme">
        </iron-ajax>
    
        <div class="container">
        
            <mb-map 
                mapapikey="[[mbkey]]"
                map="{{map}}"
                cbox="{{cbox}}"
                zoom="{{zoom}}"
                lnglat="{{lnglat}}"
                mapctrl="[[mapctrl]]">
            </mb-map>

            <mb-routes
                map="[[map]]" 
                url="[[url]]"
                fps="[[fps]]"
                timescale="[[timescale]]"
                trackctrl="{{trackctrl}}"
                trackmode="{{trackmode}}"
                trackobj = "{{trackobj}}"
                trackinfo="[[trackinfo]]">
            </mb-routes>                

            <mb-routes-ctrl
                trackctrl="{{trackctrl}}">
            </mb-routes-ctrl>    

            <mb-routes-ctrl-mode
                trackmode="{{trackmode}}">
            </mb-routes-ctrl-mode>    

            <mb-routes-ctrl-time
                timescale="{{timescale}}"
                fps="{{fps}}">
            </mb-routes-ctrl-time>    

            <mb-info lnglat="[[lnglat]]">
            </mb-info>

            <paper-dropdown-menu label="Flight sets">
                <paper-listbox class="dropdown-content" selected="0" on-iron-select="selectedurl" attr-for-selected="url">
                    <template is="dom-repeat" items="{{wpdocs}}">
                        <paper-item url="{{item.url}}">
                            {{item.title}}
                        </paper-item>
                    </template>
    </paper-listbox>
    </paper-dropdown-menu>

    </div>

    </template>

    <script>
        var app = document.querySelector('#app');
        app.setupurl = "routemap.json";
        app.url = "";

        app.mbkey = "pk.eyJ1Ijoib25lcHV0aW4iLCJhIjoiY2ltbHBidWxhMDAwa3ZubHdpNHMwdmNwMiJ9.XnPbDF8YdaDgfMFAVi9Vyw";
        app.cbox = "13.7,52.4";
        app.lnglat = "13.7,52.4";
        app.zoom = 1;
        app.mapctrl = {};
        app.selectedurl = function(e) {
            // after selection in paper-listbox
            this.url = e.detail.item.url;
        }
        app.setupme = function(ajaxresponse) {
            // iron-ajax response
            this.wpdocs = ajaxresponse.detail.response;
            // console.log("setupdata", this.wpdocs);
        }
    </script>
</body>

</html>