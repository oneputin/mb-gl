<!doctype html>
<html>
<head>
    <title>routing-tracks demo</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1, user-scalable=no"><!-- user-scalable=no" -->
    <!--<meta name="viewport" content="initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,width=device-width,user-scalable=no" />-->
    <script src="../../webcomponentsjs/webcomponents-lite.js"></script>
   
    <!-- web-components required for dev-gui --> 
    <link rel="import" href="../../iron-demo-helpers/demo-pages-shared-styles.html">
    <link rel="import" href="../../iron-demo-helpers/demo-snippet.html">
    <link rel="import" href="../../paper-styles/demo-pages.html">
   
    <!-- web-components applied for app-gui --> 
    <link rel="import" href="../../iron-flex-layout/iron-flex-layout.html">
    <link rel="import" href="../../iron-collapse/iron-collapse.html"><!-- toast -->
    <link rel="import" href="../../paper-radio-button/paper-radio-button.html"> <!-- ctrls  -->

    <!-- app-components related to map-api --> 
    <link rel="import" href="../dynamic-toast.html">
    <link rel="import" href="../mb-map.html">
    <link rel="import" href="../mb-location-log.html">
   <!--<link rel="import" href="../mb-styles.html">-->
   <!--<link rel="import" href="../mb-distance.html">-->
   <!--<link rel="import" href="../mb-orientation-ctrl.html">-->

    <!-- generic components for app-content-ctrl -->
    <link rel="import" href="../mb-content-browser.html"> 
    <link rel="import" href="../mb-content-manager.html">
    <!--<link rel="import" href="../mb-content-select.html">-->

    <!-- generic animation components -->
    <!--<link rel="import" href="../routing-api.html">
    <link rel="import" href="../timer-ctrl.html">
    <link rel="import" href="../timer-setup.html">-->

    <!-- specific animation components for some datasources -->
    <link rel="import" href="../tracks-info.html">
    <link rel="import" href="../tracks-api.html">
    <link rel="import" href="../tracks-load.html">
    <link rel="import" href="../layer-waypoints.html">

    <link rel="import" href="../tracklog-map.html">
    <link rel="import" href="../tracklog-view.html">
    <link rel="import" href="../tracklog-ctrl.html">

    <style is="custom-style">

        .container {
            top: 0; bottom: 0; /*height: 500px;*/
            height: 100vh;
            @apply(--layout-horizontal);
            /*align-items: flex-start;*/
        }
        
        .map_area {
            position:relative; top:0; bottom:0; width:100%; 
            /*width: 800px; height: 670px;*/
        }

        .ctrls_area {
            /* itself flex layouted div */
            width: 0; 
            /*width: 40%;x
            margin-left: 10px;
            @apply(--layout-vertical);
            /*@apply(--layout-start);*/
        }

        mb-map {
            position:absolute; top:0; bottom:0; width:100%;
            /*width: 55%;*/
            /*width: 800px; height: 670px;*/
        }
        
        .mapctrls-bottom {
            display: inline-block;
            position: absolute;
            @apply(--layout-horizontal);
            @apply(--layout-center);
            bottom: 12px;
            width: 100%;
        }


        .flexchild {
            @apply(--layout-flex);
        }
        
        timer-ctrl {
            @apply(--layout-flex);
        }
        
        mb-orientation-ctrl {
            /*@apply(--layout-flex);*/
        }
        
        timer-setup {
            display: none;
            border-style: solid;
            border-width: 1px;
            padding: 10px;
            /*position: absolute;
              top: 40px;
              right: 20px; */
        }
        
        mb-content-browser {
            padding: 10px;
            top : 0px;
            left : 0px;
            z-index: 9;
            background-color: rgba(255,255,255,0.3); /*#ff4081*/
            color: white;  
            /*display: inline-block;*/
            /*@apply(--layout-vertical);
            @apply(--layout-start);*/
        }

        tracklog-view {
            top: 0;
            right: 0; 
            z-index: 9;
            padding: 10px;
        }

        /* tracklog-ctrl {
            top : 0px;
            left : 0px;
            padding: 10px;
            display: inline-block;
            @apply(--layout-vertical);
            @apply(--layout-start);
        }*/
        
        #radios {
            padding: 10px;
            display: inline-block;
            @apply(--layout-vertical);
            @apply(--layout-start);
        }
        
        paper-radio-button {
            /*align-self: center;*/
            border: 1px solid var(--paper-green-200);
            padding: 8px 16px;
            margin: 8px 0px;
        }
        
        paper-radio-button.red {
            --paper-radio-button-checked-color: var(--paper-red-500);
            --paper-radio-button-checked-ink-color: var(--paper-red-500);
            --paper-radio-button-unchecked-color: var(--paper-red-900);
            --paper-radio-button-unchecked-ink-color: var(--paper-red-900);
            --paper-radio-button-label-color: var(--paper-red-500);
        }

    </style>
</head>

<body>

<template is="dom-bind" id="app">

    <div class="container">

        <!-- LEFT block: CONTENT (Map, diagram, list) -->
        <div id="content" class="map_area flexchild">

            <template is="dom-if" if="{{mapstyle}}">
                
                <mb-map 
                    map="{{map}}" 
                    mobilemode = "[[ctrl.mobilemode]]"
                    mapapikey="[[mbkey]]" 
                    mapstyle="[[mapstyle]]" 
                    mbid="{{mbid}}" 
                    cbox="{{cbox}}" 
                    zoom="{{zoom}}" 
                    mapctrl = "[[mapctrl]]">

                    <div>

                        <mb-content-browser 
                            indexurl="[[indexurl]]" 
                            metadatasetslabel="[[metadatasetslabel]]" 
                            metadataset="{{metadataset}}"

                            dataset = "[[dataset]]" 
                            ctrlitems = "[[ctrlitems]]"
                            selectitem ="{{datasetitem}}"> 

                        </mb-content-browser>

                        <!-- placed here to overlay the map -->
                        <tracklog-view
                            disable = "[[ctrl.userouting]]"
                            checked = "{{ctrl.trackdetailshow}}"
                            metadata = "[[metadataset]]"
                            trackfeature = "[[datasetitem]]"
                            logdata = "[[logdata]]"
                            logindex = "{{logindex}}">
                        </tracklog-view>    

                    </div>    
                    <!-- (menulike)ctrl of single log-points  
                    <tracklog-ctrl
                        class = "mapctrl-log"
                        visible = "[[ctrl.trackdetailshow]]"
                        metadata = "[[metadataset]]"
                        logdata = "[[logdata]]"
                        logindex = "{{logindex}}">
                    </tracklog-ctrl>-->

                    <!-- Select-menu of map-styles -->
                    <!--<mb-styles 
                        checked = "{{ctrl.styleselectshow}}"
                        styleset ="[[morestyles]]"
                        selectable = "{{styleselectable}}"
                        mapstyle = "{{mapstyle}}"> 
                    </mb-styles>-->

                    <!-- TOOL to measure user-generated lines -->
                    <!--<mb-distance 
                        checked="[[ctrl.mapmeasureshow]]"
                        distance="{{distance}}" 
                        map="[[map]]"> 
                    </mb-distance>-->

                    <!-- Indicator of mapclient-coordinates (mapcenter,mouse) -->
                    <mb-location-log 
                        checked
                        lnglat="{{lnglat}}" 
                        mbid="[[mbid]]"
                        mousemode="[[ctrl.mousemode]]"> 
                    </mb-location-log>
                    <!-- not implemented 
                    <tracks-info 
                        metadataset = "[[metadataset]]" 
                        trackinfo = "[[trackinfo]]" 
                        trackdata = "{{trackdata}}">
                    </tracks-info>
                    -->
                    <!-- animation-ctrls -->
                    <template is="dom-if" if="{{ctrl.userouting}}">
                        <div class="mapctrls-bottom">
                            <!-- ctrl of animation-progress  -->
                            <timer-ctrl 
                                timerctrl="{{trackctrl}}"
                                timer="{{timer}}">
                            </timer-ctrl>
                            <!-- ctrlflag of map-orientation -->
                            <mb-orientation-ctrl 
                                trackmap="[[trackalignmap]]">
                            </mb-orientation-ctrl>

                        </div>
                    </template>
                </mb-map>
            </template>  

            <dynamic-toast 
                text = "[[maptoast]]">
            </dynamic-toast>
  
        </div>

        <!-- RIGHT Block: several external app-controls -->
        <div class="ctrls_area">

            <tracks-load 
                maptoast = "{{maptoast}}"
                routemode = "[[ctrl.userouting]]"
                tracksetmeta = "[[metadataset]]" 
                trackdata = "{{trackdata}}"> 
            </tracks-load>

            <!-- B.2 TRACK-Explorer -->
            <tracks-api 
                maptoast = "{{maptoast}}"
                disable = "[[ctrl.userouting]]"
                rawcontent = "[[trackdata]]" 
                metadata = "{{metadataset}}" 
                contentcase = "{{contentcase}}" 
                mapcontent = "[[mapcontent]]"
                trackevents = "{{trackevents}}"
                tracksall = "[[dataset]]"
                trackitem = "{{datasetitem}}"
                tracklog = "{{logdata}}">
            </tracks-api>

            <tracklog-map
                maptoast = "{{maptoast}}"
                disable = "[[ctrl.userouting]]"
                mobilemode = "[[ctrl.mobilemode]]"
                draggable = "[[ctrl.trackdraggable]]"
                mbid = "[[mbid]]" 
                logdata = "[[logdata]]"
                index = "{{logindex}}">
            </tracklog-map>

            <layer-waypoints 
                mbid = "[[mbid]]" 
                visible = "[[ctrl.waypointshow]]" 
                querymeta = "[[metadataset]]"
                wpdata = "{{wpdata}}"> 
            </layer-waypoints>

            <!-- SYNC mapcontent from contentcase -->
            <mb-content-manager 
                map = "[[map]]" 
                mbid = "[[mbid]]" 
                mobilemode = "[[ctrl.mobilemode]]"
                contentcase = "{{contentcase}}" 
                mapevents = "[[trackevents]]"
                mapcontent = "{{mapcontent}}"
                dataset = "{{dataset}}">
            </mb-content-manager>

        </div>

    </div>
</template>

<script>
    // 
    var scope = document.querySelector('#app');
    // scope.mobilemode = (typeof window.orientation !== "undefined") || (navigator.userAgent.indexOf('IEMobile') !== -1);
    scope.mbkey = "pk.eyJ1Ijoib25lcHV0aW4iLCJhIjoiY2ltbHBidWxhMDAwa3ZubHdpNHMwdmNwMiJ9.XnPbDF8YdaDgfMFAVi9Vyw";
    scope.mapstyle = 'mapbox://styles/mapbox/light-v9';
    scope.morestyles = "demo-styles.json";

    // Data-INIT
    // scope.indexurl = "index-handheld-1.json"; // list of available datasets
    // scope.indexurl = "https://firebasestorage.googleapis.com/v0/b/intense-heat-7852.appspot.com/o/index-handheld-1.json?alt=media&token=b714e209-c4c5-481c-afb7-704157d59c20";
    // scope.indexurl = "https://drive.google.com/open?id=0B8PwJedJvqjvT05Yc0ZDODU4a0k";
    // scope.indexurl = "https://www.dropbox.com/s/s0x5j8d90unz9rd/index-sulawesi.json?raw=1";
    // scope.indexurl = "https://dl.dropboxusercontent.com/s/s0x5j8d90unz9rd/index-sulawesi.json?raw=1";
    // scope.indexurl = "https://dl.dropboxusercontent.com/s/dlcaahtl4r9ay79/index-handheld-1.json?raw=1";
    // scope.indexurl = "https://clouds.iimaps.de/assets/data/index-sulawesi.json";
    scope.indexurl = "https://clouds.iimaps.de/assets/data/index-mobile.json";
    scope.metadatasetslabel="Trackbooks"
    scope.metadataset = {}; // metadata of selected dataset

    scope.basedataurl = ""; // list of available datasets
    scope.dataset = []; // collection 
    scope.datasetitem = {}; // track/route-object

    // Map-INIT
    scope.cbox = "13,53"; // Berlin
    // scope.cbox = "122 , 0"; // Sulawesi
    scope.zoom = 8;

    // STATE init
    // mobilemode : (typeof window.orientation !== "undefined") || (navigator.userAgent.indexOf('IEMobile') !== -1),
    scope.ctrl = {
        // mobilemode : mobilemode,
        mobilemode : true,
        mousemode : false, 
        userouting : false,
        waypointshow : true,
        trackdraggable : true, 
        trackdetailshow : false,
        styleselectshow : false,
        mapmeasureshow : false
    };
    
    // Additional (specific) ctrl-items 
    scope.ctrlitems = [
        {
            id: "all",
            title: "All tracks"
        },
        {
            id: "waypoints",
            title: "All waypoints"
        }
    ];

    // Animation- INIT
    scope.trackalignmap; // 
    scope.timer = {}; //
    scope.starttimer = {  // parameters used if not defined otherwise in metadata
        "timescalemax": 600 // 1min ~ 10h
        //"timescalestart": 300
        //"fpsstart": 30
        //"tracelength": true //  '0.0.0.0.5'
    };

    // SHELL-actions
    scope.mapctrl = {};

    document.addEventListener('WebComponentsReady', function() {
        
        // Switch "visibility" of elements related with routing-api- and routing-gui  
        function toggleRouting(radio) {
            if (!radio) scope.ctrl.userouting = false;
            else if (radio.checked)  scope.ctrl.userouting = true;
            else scope.ctrl.userouting = false;
        }

        var r1 = document.querySelector("paper-radio-button.animate");
        toggleRouting(r1); 

        if (r1) {
            // Inverse Toggling of RoutingFlag  
            r1.addEventListener("change", function(){  // console.log("R1-CHANGED", this.checked)
                toggleRouting(this); 
            });
        }

    });

</script>

</body>

</html>