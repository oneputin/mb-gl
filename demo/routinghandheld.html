<!doctype html>
<html>
<!--
Demo to view ship-data animation 
-->

<head>
    <title>mb-routes demo</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1, user-scalable=yes">
    <script src="../../webcomponentsjs/webcomponents-lite.js"></script>
    <link rel="import" href="../../iron-demo-helpers/demo-pages-shared-styles.html">
    <link rel="import" href="../../iron-demo-helpers/demo-snippet.html">
    <link rel="import" href="../../iron-flex-layout/iron-flex-layout.html">
    <link rel="import" href="../../iron-collapse/iron-collapse.html">
    <link rel="import" href="../../paper-item/paper-item.html">
    <link rel="import" href="../../paper-listbox/paper-listbox.html">
    <link rel="import" href="../../paper-dropdown-menu/paper-dropdown-menu.html">
    <link rel="import" href="../../paper-radio-button/paper-radio-button.html">

    <link rel="import" href="../mb-map.html">
    <link rel="import" href="../mb-location-log.html">
    <!--<link rel="import" href="../mb-info-drag.html">-->
    <link rel="import" href="../mb-distance.html">
    <link rel="import" href="../mb-quickview.html">

    <link rel="import" href="../mb-routes.html">
    <link rel="import" href="../mb-routes-ctrl.html">
    <link rel="import" href="../mb-map-orientation-ctrl.html">
    <link rel="import" href="../mb-routes-ctrl-time.html">

    <link rel="import" href="../routing-handheld.html">
    <link rel="import" href="../mb-tools-behavior.html">
    <link rel="import" href="../app-data-sources.html">

    <link rel="import" href="../../paper-styles/demo-pages.html">

    <style is="custom-style">
        .container {
            @apply(--layout-horizontal);
            /*align-items: flex-start;*/
        }
        
        mb-map {
            /*width: 55%;*/
            width: 800px;
            height: 680px;
        }
        
        .ctrls-in {
            display: inline-block;
            position: absolute;
            @apply(--layout-horizontal);
            @apply(--layout-center);
            bottom: 12px;
            width: 100%;
        }
        
        .ctrls-out {
            /* itself flex layouted div */
            width: 40%;
            margin-left: 10px;
            @apply(--layout-vertical);
            /*@apply(--layout-start);*/
        }
        
        mb-routes-ctrl {
            @apply(--layout-flex);
        }
        
        mb-map-orientation-ctrl {
            @apply(--layout-flex);
        }
        
        paper-dropdown-menu {
            border-style: solid;
            border-width: 1px;
            padding: 10px;
            /*position: absolute;*/
            /*background-color: var(--paper-light-green-500);
              opacity: 0.8;*/
            /*top: 40px;
              left: 30px;*/
        }
        
        mb-routes-ctrl-time {
            display: none;
            border-style: solid;
            border-width: 1px;
            padding: 10px;
            /*position: absolute;
              top: 40px;
              right: 20px; */
        }
        
        #radios {
            padding: 10px;
            display: inline-block;
            @apply(--layout-vertical);
            @apply(--layout-start);
        }
        
        app-data-sources {
            padding: 10px;
            display: inline-block;
            @apply(--layout-vertical);
            @apply(--layout-start);
        }
        
        paper-radio-button {
            /*align-self: center;*/
            border: 1px solid var(--paper-green-200);
            padding: 8px 16px;
            margin: 8px 0px;
        }
        
        paper-radio-button.red {
            --paper-radio-button-checked-color: var(--paper-red-500);
            --paper-radio-button-checked-ink-color: var(--paper-red-500);
            --paper-radio-button-unchecked-color: var(--paper-red-900);
            --paper-radio-button-unchecked-ink-color: var(--paper-red-900);
            --paper-radio-button-label-color: var(--paper-red-500);
        }
    </style>
</head>
<body>

<template is="dom-bind" id="app">
        
    <iron-ajax auto url="[[setupurl]]" handle-as="json" on-response="loadRouteSetIndex">
    </iron-ajax>

    <div class="container">
        <!-- Left block: Map -->

        <!-- lnglat="{{lnglat}} -->" 
        <mb-map 
            mapapikey="[[mbkey]]" 
            mapstyle="[[mbstyle]]" 
            map="{{map}}" 
            cbox="{{cbox}}" 
            zoom="{{zoom}}" 
            mapctrl="[[mapctrl]]">
            
            <!-- TOOL to measure user-generated lines -->
            <mb-distance 
                map="{{map}}" 
                distance="{{distance}}" 
                checked="[[usemeasure]]">
            </mb-distance>

            <div class="ctrls-in">
                <template is="dom-if" if="{{!usepreview}}">
                    <!-- ctrl of animation (and maporientation) -->
                    <mb-routes-ctrl 
                        checked="[[userouting]]"
                        timer="{{timer}}"
                        trackctrl="{{trackctrl}}">
                    </mb-routes-ctrl>
                </template>
                <!-- ctrl of maporientation -->
                <!-- <mb-map-orientation-ctrl 
                    trackmode="{{trackmode}}">
                    </mb-map-orientation-ctrl>-->
            </div>


            <mb-location-log map="{{map}}" lnglat="{{lnglat}}" checked="[[uselocationlog]]">
            </mb-location-log>

            <!--<mb-info-drag carddata="[[trackdata]]">
                        </mb-info-drag>-->
        </mb-map>

        <!-- Right Block: several external app-controls -->
        
        <div class="ctrls_out">
            
            <!-- INTERFACE -->
            <routing-handheld 
                routesrc="[[routesrc]]" 
                usepreview="[[usepreview]]"
                routedata="{{routedata}}" 
                quickmap="{{mapcontent}}" 
                rawdata="{{rawdata}}" 
                basedataurl="[[basedataurl]]" 
                trackinfo="[[trackinfo]]" 
                trackdata="{{trackdata}}">
            </routing-handheld>

            <!--<mb -->

            <!-- elements for viewing structurally standardized quickMapObjects -->
            <mb-quickview 
                map="[[map]]" 
                mapcontent="[[mapcontent]]" 
                checked="[[usepreview]]" 
                featurelist="{{routedata}}" 
                featureselected="{{featureselected}}">
            </mb-quickview>

            <!-- element with [n] visible features -->
            <template is="dom-if" if="{{!usepreview}}">
                <mb-routes 
                    map="[[map]]" 
                    timer="{{timer}}"
                    routedata=[[routedata]] 
                    routeid=[[routeid]] 
                    trackctrl="{{trackctrl}}" 
                    trackmapmode="{{trackmapmode}}" 
                    trackdata="{{trackdata}}"
                    trackinfo="[[trackinfo]]"
                    mapcontent="{{mapcontent}}"                  
                    tracksymbol="{{tracksymbol}}" 
                    checked="[[userouting]]">
                </mb-routes>
                
                <!--timescalemax="[[timer.timescalemax]]" fps="{{timer.fps}}" timescale="{{timer.timescale}}">-->
                <mb-routes-ctrl-time  
                    checked="[[userouting]]"
                    timescalemax="[[timer.timescalemax]]" 
                    timer="{{timer}}">
                </mb-routes-ctrl-time>
            </template>

            <div id="radios">
                <paper-radio-button checked="{{uselocationlog}}">Location Log</paper-radio-button>
                <paper-radio-button checked="{{usemeasure}}">Measure</paper-radio-button>
                <paper-radio-button class="red" checked="{{usepreview}}">CheckSources</paper-radio-button>
            </div>

            <!--dataset= "{{routedata}}" ??? -->
            <app-data-sources
                indexurl="[[indexurl]]"
                datasets="[[routesets]]"
                datasetslabel="Flight sets"
                dataset= "{{routeset}}"
                selectprop="id"
                selectvalue= "{{routeid}}"
                datasetlabel= "Flights">
            </app-data-sources>    
        <!--
            <div id="menues">
                <paper-dropdown-menu label="Tracksets">
                    <paper-listbox class="dropdown-content" selected="0" on-iron-select="selectRouteSet" attr-for-selected="src">
                        <template is="dom-repeat" items="{{routesets}}">
                                <paper-item src="{{item}}" url="{{item.url}}">
                                    {{item.title}}
                                </paper-item>
                            </template>
                    </paper-listbox>
                </paper-dropdown-menu>

                <paper-dropdown-menu class="routes" label="Tracks">
                    <paper-listbox class="dropdown-content" selected="0" on-iron-select="selectRoute" attr-for-selected="{{selectattr}}">
                        <template is="dom-repeat" items="{{routedata}}">
                                    <paper-item feature="{{item}}" id="{{item.id}}">
                                        {{item.title}}
                                    </paper-item>
                                </template>
                    </paper-listbox>
                </paper-dropdown-menu>

            </div>
        -->

        </div>

    </div>

</template>

<script>
    var scope = document.querySelector('#app');
    scope.mbkey = "pk.eyJ1Ijoib25lcHV0aW4iLCJhIjoiY2ltbHBidWxhMDAwa3ZubHdpNHMwdmNwMiJ9.XnPbDF8YdaDgfMFAVi9Vyw";
    scope.mbstyle = 'mapbox://styles/oneputin/ciuz8mtxy01dx2jl8mszelrkm'; // 

    // Data-INIT
    scope.setupurl = "index-handheld.json"; // list of available datasets
    scope.basedataurl = ""; // list of available datasets
    scope.routesrc = {}; // url to selected dataset

    // Map-INIT
    scope.cbox = "13,52";
    scope.zoom = 8;
    // scope.lnglat = "13,52";

    // STATE init
    scope.uselocationlog = true;
    scope.usepreview = true;

    // Animation- INIT
    scope.tracksymbol = 'toilet-11';
    // console.log("scope.tracelength", scope.tracelength, scope.utcTime(scope.tracelength));
    scope.trackmapmode; // 
    scope.timer = {
        "timescalemax": 600, // 1min ~ 10h
        "timescalestart": 300,
        "fpsstart": 30
            // "tracelength": true //  '0.0.0.0.5'
    };

    // SHELL-actions
    scope.mapctrl = {};

    // MB-Feature-selection
    scope.featureselected = "{}";
    // attribute of selected item to be processed further
    scope.selectattr = "feature"; // Preview
    // scope.selectattr = "id"; // Route 

    // 
    scope.selectRoute = function(e) {
        var selectvalue = e.detail.item[scope.selectattr];
        // console.log("selected item:", selectvalue);
        if (scope.selectattr == "id") scope.routeid = selectvalue;
        else scope.featureselected = selectvalue;
    };

    /**
        * Put selected src from menu-selection into import-element
        */
    scope.selectRouteSet = function(e) {
        this.routesrc = e.detail.item.src;
    }

    // eval the response of content-list 
    scope.loadRouteSetIndex = function(ajaxresponse) {
        this.routesets = ajaxresponse.detail.response;
    }
</script>

</body>
</html>