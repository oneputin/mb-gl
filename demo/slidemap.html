<!doctype html>
<html>

<head>
    <title>mb-gl demo</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1, user-scalable=yes">

    <script src="../../webcomponentsjs/webcomponents-lite.js"></script>
    <link rel="import" href="../../iron-flex-layout/iron-flex-layout.html">
    <link rel="import" href="../../paper-input/paper-input.html">

    <link rel="import" href="../mb-map.html">
    <link rel="import" href="../mb-location-log.html">

    <link rel="import" href="../mb-slide.html">
    <link rel="import" href="../mb-target.html">
    <link rel="import" href="../mb-zoom.html">

    <style is="custom-style">
        mb-map {
            width: 50%;
            height: 400px;
        }
        
        mb-info-lnglat {
            left: 50%;
            margin-right: -50%;
            transform: translate(-50%, 0)
        }
        
        .flex-horizontal {
            @apply(--layout-horizontal);
        }
        
        .flexchild {
            @apply(--layout-flex);
        }
        
        div.ctrlbox {
            background-color: cyan;
            padding: 5px;
            margin: 0px 10px;
        }
        
        paper-dialog.colored {
            border: 2px solid;
            border-color: var(--paper-green-500);
            background-color: var(--paper-light-green-50);
            color: var(--paper-green-500);
        }
        
        paper-input.slidecenter {
            background-color: var(--paper-light-blue-50);
        }
    </style>

</head>

<body>

    <h1>element-demo: mb-slide</h1>

    <template is="dom-bind" id="app-demo">
        
        <div class="container flex-horizontal">
            
            <!-- LEFT container: Map -->
            <!--zoom="[[zoom]]"-->
            <mb-map 
                mapapikey="[[mbkey]]"
                map="{{map}}"
                cbox="{{cbox}}"
                zoom="{{zoom}}"
                mapctrl="[[mapctrl]]">

                <mb-slide
                    map="[[map]]"
                    serviceparams="[[serviceparams]]"
                    cbox="[[cbox]]"
                    slidectrl="[[layerctrl]]" 
                    slideinfo="{{slideinfo}}"
                    serviceflag="{{flag}}">
                </mb-slide>
                
                <mb-target 
                    serviceflag="{{flag}}">
                </mb-target>

                <mb-location-log map="{{map}}" lnglat="{{lnglat}}" mode="map" checked>
                </mb-location-log>

            </mb-map>

            <!-- RIGHT container: Info -->
            <div class="ctrlbox flexchild">

                <!-- A. external map-zoom-ctrl -->
                <mb-zoom map="{{map}}" title="External mapZoom"></mb-zoom>
                <hr>
                <!-- B. external input to change map-center -->
                <paper-input 
                    class="slidecenter"
                    label="actual target at (lngLat) = [[cbox]]" 
                    value="{{cboxinput}}" 
                    always-float-label 
                    on-focused-changed="focuschanged">
                </paper-input>

                <!-- C. Quer-data-viewer -->
                <ul>
                    <li>Slidesquery action can be toggled with the central  <b>target marker</b> red-selecting, black-inert.</li> 
                    <li>The FAB forces a zoom to the actually selected slide (disabling selection-mode).</li>
                </ul>
                <h4>SlideLog</h4>
                <p>[[slideinfo]]</p>

            </div>
            
        </div>

    </template>

    <script>
        var scope = document.querySelector('#app-demo');
        scope.map = null;
        scope.serviceparams = {
            slide: "basintree"
        };
        scope.cbox = "13.7,52.4";
        scope.cboxinput = "";
        scope.mbkey = "pk.eyJ1Ijoib25lcHV0aW4iLCJhIjoiY2ltbHBidWxhMDAwa3ZubHdpNHMwdmNwMiJ9.XnPbDF8YdaDgfMFAVi9Vyw";
        scope.mapctrl = {};
        scope.layerctrl = {};
        scope.popuptitle = "slideinfo";
        scope.slidekeys = "";

        scope.asstring = function(slideinfo) {
            console.log(slideinfo);
            var txt = JSON.stringify(slideinfo, null, '\n')
            return txt;
        };

        // 
        scope.focuschanged = function(e) {
            // console.log("focus changed", e);
            if (!e.detail.value) {
                scope.cbox = scope.cboxinput;
                scope.cboxinput = "";
            } else {
                let cbox = scope.cbox.split(",");
                scope.cboxinput = parseFloat(cbox[0]).toFixed(3) + "," + parseFloat(cbox[1]).toFixed(3);
            }
            //  app.cbox = v;
        }

        document.addEventListener('WebComponentsReady', function() {
            // var cboxin = document.querySelector('#cboxin');
            var cboxin = scope.$.cboxin; // console.log("cboxin:", cboxin);
            /* cboxin.addEventListener('value-changed', function() { 
                console.log("cboxin", this.value);
                app.cbox = cboxin.value;
            });*/
        });
    </script>
</body>

</html>