<!doctype html>
<html>

<head>
    <title>mb-gl demo</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1, user-scalable=yes">

    <script src="../../webcomponentsjs/webcomponents-lite.js"></script>
    <link rel="import" href="../../iron-flex-layout/iron-flex-layout.html">
    <link rel="import" href="../../paper-input/paper-input.html">

    <link rel="import" href="../mb-map.html">
    <link rel="import" href="../mb-location-log.html">

    <link rel="import" href="../mb-slide.html">
    <link rel="import" href="../mb-target.html">
    <link rel="import" href="../mb-zoom.html">

    <style is="custom-style">
        mb-map {
            width: 100%;
            height: 100%;
        }
        
        mb-info-lnglat {
            left: 50%;
            margin-right: -50%;
            transform: translate(-50%, 0)
        }
        
        .flex-horizontal {
            @apply(--layout-horizontal);
        }
        
        .flexchild {
            @apply(--layout-flex);
        }

        .container {
            top: 0; bottom: 0; /*height: 500px;*/
            height: 100vh;
            @apply(--layout-horizontal);
            /*align-items: flex-start;*/
        }

        div.ctrlbox {
            background-color: cyan;
            padding: 5px;
            margin: 0px 10px;
        }
        
        paper-dialog.colored {
            border: 2px solid;
            border-color: var(--paper-green-500);
            background-color: var(--paper-light-green-50);
            color: var(--paper-green-500);
        }
        
        paper-input.slidecenter {
            background-color: var(--paper-light-blue-50);
        }
    </style>

</head>

<body>


    <template is="dom-bind" id="app-demo">
        
        <div class="container">
        
            <!-- LEFT container: Map -->
            <!--zoom="[[zoom]]"-->
            <mb-map 
                mapapikey="[[mbkey]]"
                map="{{map}}"
                cbox="{{cbox}}"
                zoom="{{zoom}}"
                mapctrl="[[mapctrl]]">

                <mb-slide
                    map="[[map]]"
                    serviceparams="[[serviceparams]]"
                    target="[[target]]"
                    slidectrl="[[slidectrl]]" 
                    slideinfo="{{slideinfo}}"
                    serviceflag="{{serviceflag}}">
                </mb-slide>
                
                <mb-target 
                    map = [[map]]
                    target={{target}}
                    targetarea="[[targetarea]]"
                    serviceflag="{{serviceflag}}">
                </mb-target>

                <mb-location-log 
                    map="{{map}}" 
                    lnglat="{{lnglat}}" 
                    centermode="true" 
                    checked>
                </mb-location-log>

            </mb-map>

            <!-- RIGHT container: Info -->
            <div class="ctrlbox">
            </div>
            
        </div>

    </template>

    <script>
        var scope = document.querySelector('#app-demo');
        scope.serviceparams = {
            slide: "basintree"
        };
        scope.targetarea = [
            [-10, 35], // SouthWest 
            [40, 65] // NorthEast
        ]
        scope.slidectrl = {};

        scope.map = null;
        scope.cbox = "13.5,52.5"; // Home
        scope.cboxinput = "";
        scope.mbkey = "pk.eyJ1Ijoib25lcHV0aW4iLCJhIjoiY2ltbHBidWxhMDAwa3ZubHdpNHMwdmNwMiJ9.XnPbDF8YdaDgfMFAVi9Vyw";
        scope.mapctrl = {
            center: [10,52],
        };


        scope.asstring = function(slideinfo) {
            console.log(slideinfo);
            var txt = JSON.stringify(slideinfo, null, '\n')
            return txt;
        };

        // 
        scope.focuschanged = function(e) {
            // console.log("focus changed", e);
            if (!e.detail.value) {
                scope.cbox = scope.cboxinput;
                scope.cboxinput = "";
            } else {
                let cbox = scope.cbox.split(",");
                scope.cboxinput = parseFloat(cbox[0]).toFixed(3) + "," + parseFloat(cbox[1]).toFixed(3);
            }
            //  app.cbox = v;
        }

        document.addEventListener('WebComponentsReady', function() {
            // var cboxin = document.querySelector('#cboxin');
            var cboxin = scope.$.cboxin; // console.log("cboxin:", cboxin);
            /* cboxin.addEventListener('value-changed', function() { 
                console.log("cboxin", this.value);
                app.cbox = cboxin.value;
            });*/
        });
        
    </script>
</body>

</html>