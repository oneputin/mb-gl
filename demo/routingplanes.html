<!doctype html>
<html>

<head>
    <title>routing-api demo</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1, user-scalable=yes">
    <script src="../../webcomponentsjs/webcomponents-lite.js"></script>

    <link rel="import" href="../../iron-demo-helpers/demo-pages-shared-styles.html">
    <link rel="import" href="../../iron-demo-helpers/demo-snippet.html">
    <link rel="import" href="../../paper-styles/demo-pages.html">

    <link rel="import" href="../../iron-flex-layout/iron-flex-layout.html">
    <link rel="import" href="../../iron-collapse/iron-collapse.html">

    <link rel="import" href="../mb-content-browser.html">

    <link rel="import" href="../mb-map.html">
    <link rel="import" href="../mb-location-log.html">
    <link rel="import" href="../mb-orientation-ctrl.html">

    <link rel="import" href="../routing-planes.html">
    <link rel="import" href="../routing-api.html">
    <link rel="import" href="../routing-ctrl.html">
    <link rel="import" href="../routing-ctrl-time.html">


    <style is="custom-style">
        .container {
            position: relative;
            width: 100%;
            height: 100%;
            /*@apply(--layout-horizontal);
            align-items: flex-start;*/
        }
        
        mb-map {
            width: 100%;
            height: 675px;
        }
        
        routing-ctrl-mode {
            position: absolute;
            bottom: 10px;
            right: 10px;
        }
        
        routing-ctrl {
            position: absolute;
            bottom: 10px;
            left: 30px;
        }
        
        mb-orientation-ctrl {
            position: absolute;
            bottom: 10px;
            right: 30px;
        }
        
        mb-content-browser {
            position: absolute;
            padding: 10px;
            left: 30px;
            top: 40px;
        }
        
        routing-planes {
            border-style: solid;
            border-width: 1px;
            padding: 10px;
            position: absolute;
            background-color: var(--paper-light-green-500);
            opacity: 0.8;
            left: 300px;
            top: 40px;
        }
        
        routing-ctrl-time {
            display: none;
            border-style: solid;
            border-width: 1px;
            padding: 10px;
            position: absolute;
            top: 40px;
            right: 20px;
        }
    </style>
</head>

<body>

    <template is="dom-bind" id="app">
        
        <div class="container">

            <mb-map 
                mapapikey="[[mbkey]]" 
                mapstyle="[[mbstyle]]"
                map="{{map}}" 
                cbox="{{cbox}}" 
                zoom="{{zoom}}" 
                lnglat="{{lnglat}}" 
                mapctrl="[[mapctrl]]">
                
                <mb-content-select
                    map="[[map]]"
                    mapcontent="[[mapcontent]]">
                </mb-content-select>

                <routing-ctrl 
                    timer="{{timer}}"
                    trackctrl="{{trackctrl}}">
                </routing-ctrl>

                <mb-orientation-ctrl 
                    trackmapmode="{{trackmapmode}}">
                </mb-orientation-ctrl>

                <mb-location-log 
                    map="{{map}}" 
                    lnglat="{{lnglat}}" 
                    checked="[[uselocationlog]]">
                </mb-location-log>
                
                <routing-api 
                    map="[[map]]" 
                    timer="{{timer}}" 
                    routedata=[[routedata]]  
                    routeid=[[routeid]]  
                    trackctrl="{{trackctrl}}" 
                    trackmapmode="{{trackmapmode}}" 
                    trackdata="{{trackdata}}"
                    trackinfo="[[trackinfo]]"
                    mapcontent="{{mapcontent}}" 
                    on-routedata-changed="logdata">
                </routing-api>
                
                <routing-ctrl-time 
                    timer="{{timer}}">
                </routing-ctrl-time>

                <!-- app-specific IF between generic IN/OUT (routedata/trackdata) and routedata -->
                <routing-planes 
                    map="[[map]]" 
                    flightset="[[routeset]]"
                    routedata="{{routedata}}" 
                    trackdata="{{trackdata}}"
                    trackinfo="{{trackinfo}}">
                </routing-planes>

                <mb-content-browser
                    indexurl="[[indexurl]]"
                    datasets="[[routesets]]"
                    datasetslabel="Flight sets"
                    dataset= "{{routeset}}"
                    datasetlabel= "Flights"
                    selectprop= "id"
                    selectvalue= "{{routeid}}">
                </mb-content-browser>    
            
            </mb-map>    
        </div>

    </template>

    <script>
        var scope = document.querySelector('#app');

        scope.indexurl = "index-planes.json";

        // setup mapbox-MAP
        scope.mbkey = "pk.eyJ1Ijoib25lcHV0aW4iLCJhIjoiY2ltbHBidWxhMDAwa3ZubHdpNHMwdmNwMiJ9.XnPbDF8YdaDgfMFAVi9Vyw";
        scope.mbstyle = 'mapbox://styles/oneputin/ciuz8mtxy01dx2jl8mszelrkm';
        // scope.mbstyle = 'mapbox://styles/mapbox/streets-v9',

        scope.cbox = "13.7,52.4";
        scope.lnglat = "13.7,52.4";
        scope.zoom = 2;

        // setup ANIMATION 
        // scope.timer = {}; // default 
        scope.timer = {
            "timescalemax": 1440, // 1min animation = 1440min(12h) reality at fps=60 
            "timescalestart": 1440,
            "fpsstart": 30, // fps applied at start (< 60(=fpsmax)
            "tracelength": '0.0.0.0.5' // Kondensstreifen = 5min reality 
                // "tracelength": true
        };
        scope.tracksymbol = 'airport-15'; // symbol used to hilite selected tracker 
        scope.mapctrl = {};

        // select a start-routeset from setup-entries 
        scope.routeset = [];

        // SETUP LISTENERS to custom events sent by other (child-)elements 
        // instead of data-binding 
        /*scope.addEventListener('dom-change', function() {
            // bind event-listener to (custom) web-element
            var el = document.querySelector('routing-planes');
            el.addEventListener('imported', function(e) {
                // eval the 
                var routedata = e.detail.routedata;
                if (routedata.length > 1) { // append the "all"-entry and trigger the GUI to contain the dropdown.menu 
                    scope.selectflag = true;
                } else {
                    scope.selectflag = false;
                }
                // ??? do here ??  
                // scope.routeset.data = routedata;
            });
        });*/
    </script>
</body>

</html>