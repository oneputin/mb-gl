<!doctype html>
<html>
<!--
Demo to view ship-data animation 
-->

<head>
    <title>routing-api demo</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1, user-scalable=yes">
    <script src="../../webcomponentsjs/webcomponents-lite.js"></script>
    <link rel="import" href="../../iron-demo-helpers/demo-pages-shared-styles.html">
    <link rel="import" href="../../iron-demo-helpers/demo-snippet.html">
    <link rel="import" href="../../iron-flex-layout/iron-flex-layout.html">
    <link rel="import" href="../../iron-collapse/iron-collapse.html">
    <link rel="import" href="../../paper-item/paper-item.html">
    <link rel="import" href="../../paper-listbox/paper-listbox.html">
    <link rel="import" href="../../paper-dropdown-menu/paper-dropdown-menu.html">

    <link rel="import" href="../mb-map.html">
    <link rel="import" href="../mb-location-log.html">
    <link rel="import" href="../mb-info-drag.html">

    <link rel="import" href="../routing-api.html">
    <link rel="import" href="../routing-ctrl.html">
    <link rel="import" href="../mb-orientation-ctrl.html">
    <link rel="import" href="../routing-ctrl-time.html">

    <link rel="import" href="../routing-vendee.html">

    <link rel="import" href="../../paper-styles/demo-pages.html">

    <style is="custom-style">
        .container {
            @apply(--layout-horizontal);
            /*align-items: flex-start;*/
        }
        
        mb-map {
            width: 55%;
            height: 600px;
        }
        
        mb-location-log {
            left: 50%;
            margin-right: -50%;
            transform: translate(-50%, 0)
        }
        
        .ctrls-in {
            display: inline-block;
            position: absolute;
            @apply(--layout-horizontal);
            @apply(--layout-center);
            bottom: 12px;
            width: 100%;
        }
        
        routing-ctrl {
            @apply(--layout-flex);
        }
        
        mb-orientation-ctrl {}
        
        .ctrls-out {
            /* itself flex layouted div */
            @apply(--layout-horizontal);
            @apply(--layout-start);
            width: 40%;
            margin-left: 10px;
        }
        
        paper-dropdown-menu {
            border-style: solid;
            border-width: 1px;
            padding: 10px;
            /*position: absolute;*/
            /*background-color: var(--paper-light-green-500);
              opacity: 0.8;*/
            /*top: 40px;
              left: 30px;*/
        }
        
        routing-ctrl-time {
            display: none;
            border-style: solid;
            border-width: 1px;
            padding: 10px;
            /*position: absolute;
              top: 40px;
              right: 20px; */
        }
    </style>

</head>

<body>
    <template is="dom-bind" id="app">
        
        <div class="container">
            
            <!-- Left block: Map -->
            <mb-map 
                mapapikey="[[mbkey]]" 
                mapstyle="[[mbstyle]]"
                map="{{map}}" 
                cbox="{{cbox}}" 
                zoom="{{zoom}}" 
                lnglat="{{lnglat}}" 
                mapctrl="[[mapctrl]]">
                
                <!-- Elements to show in map-overlay  -->
                
                <div class="ctrls-in">
                    <!-- ctrl of animation and maporientation -->
                    <routing-ctrl 
                        timer="{{tracktimer}}"
                        trackctrl="{{trackctrl}}">
                    </routing-ctrl>
                    <!--<mb-orientation-ctrl trackmode="{{trackmode}}">
                    </mb-orientation-ctrl>-->                    
                </div>

                <mb-location-log map="{{map}}" lnglat="{{lnglat}}" checked="[[uselocationlog]]">
                </mb-location-log>

                <!--<mb-info-drag carddata="[[trackdata]]">
                </mb-info-drag>-->
                
                <!-- removed properties
                    url="[[routedataurl]]" 
                    menudata="{{menudata}}"
                    tmpdata="[[tmpdata]]"
                -->
                
                <routing-vendee 
                    routedata="{{routedata}}"
                    basedataurl="[[basedataurl]]" 
                    trackinfo="[[trackinfo]]" 
                    trackdata="{{trackdata}}">
                </routing-vendee>

            </mb-map>

            <!-- Right Block: several external app-controls -->
            <div class="ctrls_out">
                <!-- element with n visible features -->
                <routing-api 
                    map="[[map]]" 
                    timer="{{tracktimer}}"
                    routedata="[[routedata]]" 
                    routeid="[[routeid]]" 
                    tracksymbol="[[tracksymbol]]" 
                    trackctrl="{{trackctrl}}" 
                    trackmode="{{trackmode}}" 
                    trackdata="{{trackdata}}"
                    trackinfo="[[trackinfo]]">
                </routing-api>
                
                <!-- Left -->
                <routing-ctrl-time  
                    timescalemax="[[tracktimer.timescalemax]]" 
                    timer="{{tracktimer}}">
                </routing-ctrl-time>

                <dataset-browser
                    dataset= "{{routeset}}"
                    dataid= "{{routeid}}"
                    indexurl="[[indexurl]]"
                    datasets="[[routesets]]"
                    datasetslabel="Flight sets"
                    datasetlabel= "Flights">
                </dataset-browser>                

                <dataset-browser 
                    indexurl="[[indexurl]]" 
                    metadatasetslabel="[[metadatasetslabel]]" 
                    metadatasets="{{routesets}}" 
                    datasetmeta="{{routedatasrc}}"

                    datasetlabel="[[datasetlabel]]"
                    dataset="[[dataset]]" 
                    selectvalue="{{datasetitem}}"> 
                </dataset-browser>

            </div>
        </div>
    </template>

    <script>
        var scope = document.querySelector('#app');

        // APP-Ctrl
        scope.mapctrl = {};
        scope.cardctrl = {};

        // MAP-Environment
        scope.mbkey = "pk.eyJ1Ijoib25lcHV0aW4iLCJhIjoiY2ltbHBidWxhMDAwa3ZubHdpNHMwdmNwMiJ9.XnPbDF8YdaDgfMFAVi9Vyw";
        scope.mbstyle = 'mapbox://styles/oneputin/ciuz8mtxy01dx2jl8mszelrkm';

        scope.tracksymbol = 'boat-blue';
        scope.cbox = "-50,-40";
        scope.lnglat = "-50,-40";
        scope.zoom = 2;

        // TRACK-Environment 
        scope.indexurl = "index-vendee.json"; // list of available datasets
        scope.basedataurl = "wp-data/vendee-db.json"; // list of available datasets
        // Timescale to view tracks of boats over several days
        scope.tracktimer = {
            "timescalemax": 10000, // 1min ~ 1week
            "timescalestart": 5000,
            "fpsstart": 30
        };

        // ROUTES - Env
        scope.routedataurl = ""; // url to selected dataset
        /**
         * Put selected url from menu-selection into import-element
         */
        
        /*scope.selectedurl = function(e) {
            console.log(e.detail.item.url);
            this.routedataurl = e.detail.item.url;
        }*/

        /*scope.selectrouteid = function(e) {
            // console.log("next routeid=", e.detail)
            var routeid = e.detail.item.id;
            if (routeid) scope.routeid = routeid;
            /*var tmpdata = []; // CLOSE !! comment !!
            scope.routedata.forEach(function(item) {
                if (item.id == routeid) {
                    if (item.flag) {
                        item.flag = false;
                        item.title = item.title.substring(1);
                    } else {
                        item.flag = true;
                        item.title = "x" + item.title;
                    }
                    // console.log("marked item", item);
                }
                tmpdata.push(item);
            });
            scope.tmpdata = tmpdata;
        }*/

    </script>
</body>

</html>