<link rel="import" href="../polymer/polymer.html">

<script>

  /**
   * `Mbb.AppBehavior` 
   *
   * @polymerBehavior Mbb.AppBehavior
   * @demo demo/index.html
   **/

    window.Mbb = window.Mbb || {};

    Mbb.AppBehavior = {

        // 
        deltaL : function(aLine, unit) {
          // aLine must be an element of src-data (!!!) , here   
          var unitshort ;
          if (!unit) unit="kilometers";
          if (unit=="kilometers") unitshort ="km";
          if (unit=="miles") unitshort ="mi";
          if (unit=="nautic") {
              unit="kilometers";
              unitshort ="nm";
          }    
          var dl = 1;
          if (typeof turf !== "undefined") dl = turf.lineDistance(aLine, unit);
          if (typeof dl == "number") {
              if (unitshort=="nm") dl = dl / 1.856; 
              dl = this.toFixed(dl, 3) + unitshort;
          }    
          return dl;
        },

        // Create readable time period h:min
        // from unixTime as [h]
        deltaT: function(t, fallback) {
            var h = Math.floor(t),
                m = Math.round((t - h) * 60);
            if (h > 0) h = h < 10 ? "0" + h + "h" : h + "h";
            else h = "";
            m = (m < 10) ? "0" + m : m;
            return h || m ? h + m + "min" : fallback;
        },

        // derive comparable/calculable times
        // from dates of type "2016.12.11,16.00" or "2016.12.16,16:00"
        utcTime: function(t, unit, lonlat) {
            // !! for parser the MONTH must be numbered 0 .. 11 !!
            var tlocal;
            if (typeof t == "string") {
                var t = t.replace(",", "."),
                    t = t.replace(":", "."),
                    a = t.split(".");

                // Time intervals 
                if (a[0] == "0") {
                    a[0] = "1970";
                    if (a[1] == "0") {
                        a[1] = "1";
                        if (a[2] == "0") {
                            a[2] = "1";
                            if (a[3] == "0") {
                                a[3] = "1";
                                if (a[4] == "0") {
                                    a[4] = "1";
                                }
                            }
                        }
                    }
                    // console.log("utcTime", t, a);
                }

                if (a.length > 5) { // 
                    tlocal = new Date(parseInt(a[0]), parseInt(a[1]) - 1, parseInt(a[2]), parseInt(a[3]), parseInt(a[4]), parseInt(a[5]));
                } else {
                    tlocal = new Date(parseInt(a[0]), parseInt(a[1]) - 1, parseInt(a[2]), parseInt(a[3]), parseInt(a[4]));
                }
            } else {
                tlocal = t;
            }

            var tg = tlocal,
                t_unit = tg;

            if (unit == "h") t_unit = tg / (1000 * 3600);
            else if (unit == "s") t_unit = tg / 1000;
            else t_unit = tg; // [ms]

            return t_unit;
        },

        /**
         * convert any(?) device-formatted track-times into "dot format"
         */
        trackTime : function (traw, asarray) { 
            if (typeof traw == "string") {
                var t = traw.replace("Z", "");
                t = t.split(":").join(".");
                t = t.split("-").join(".");
                t = t.split("T").join(".");
                // console.log(t);
                if (asarray)  return t.split(".");
                return t;
            }     
            return traw;
        },

        /**
         * 
         */
        logTime: function(ms1970, unit, sep) {
            if (unit == "h") ms1970 = ms1970 * 3600 * 1000;
            var logtime = new Date(ms1970);
            // console.log("logTime",ms1970,logtime);
            if (!sep) return logtime;

            var D = logtime.getDate(),
                M = logtime.getMonth() + 1,
                h = logtime.getHours(),
                m = logtime.getMinutes();
             
            switch (sep) {
                case 'D':
                    logtime = D;
                    break;
                case 'M':
                    logtime = M;
                    break;
                case 'h':
                    logtime = h;
                    break;
                case 'm':
                    logtime = m;
                    break;
                default:
                    // return string
                    if (sep) {
                        D = D < 10 ? "0" + D : D;
                        M = M < 10 ? "0" + M : M;
                        h = h < 10 ? "0" + h : h;
                        m = m < 10 ? "0" + m : m;
                        var logdate = D + "." + M,
                            daytime = h + ":" + m;
                        if (sep=="t") logtime = daytime;
                        else logtime = logdate + sep + daytime;
                    }
            }

            return logtime;
        },

        /**
         * TOOL
         *
         */
        objectClone: function(obj) {
            var cloned = {}; 
            if (obj) {
                Object.keys(obj).forEach(function(k){
                    cloned[k] = obj[k];
                })
            }
            return cloned; 
        },

        // get color in hex-format
        getRandomColor: function() {
            var letters = '0123456789ABCDEF';
            var color = '#';
            for (var i = 0; i < 6; i++) {
                color += letters[Math.floor(Math.random() * 16)];
            }
            return color;
        },

        // extended version optionally negative precision
        toFixed : function(number, precision) {
            var factor = Math.pow(10, precision);
            var tempNumber = number * factor;
            var roundedTempNumber = Math.round(tempNumber);
            return roundedTempNumber / factor;
        }

    };
</script>    