<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../paper-icon-button/paper-icon-button.html">

<link rel="import" href="mb-api.html">
<link rel="import" href="mb-tools-behavior.html">
<!--<link rel="import" href="mb-distance.html"> -->
<!--
`mb-map`
wraps a map created with mapbox-gl-api.  
the map-ctrls can be placed as map-overlay or anywhere else 

@demo demo/slidemap.html 
-->

<dom-module id="mb-sources-select">

    <template>
        <style>
            :host {
                display: block;
                /*position: absolute;*/
            }
        </style>
        
        <iron-ajax auto url="[[setupurl]]" handle-as="json" on-response="loadRouteSetIndex">
        </iron-ajax>

        <!-- menu of available routesets -->
        <paper-dropdown-menu label="Tracksets">
            <paper-listbox class="dropdown-content" selected="0" on-iron-select="selectRouteSet" attr-for-selected="src">
                <template is="dom-repeat" items="{{routesets}}">
                <paper-item src="{{item}}" url="{{item.url}}">
                    {{item.title}}
                </paper-item>
            </template>
            </paper-listbox>
        </paper-dropdown-menu>

        <!-- menu of Tracks contained in activated routesets -->
        <paper-dropdown-menu class="routes" label="Tracks">
            <paper-listbox class="dropdown-content" selected="0" on-iron-select="selectRoute" attr-for-selected="{{selectattr}}">
                <template is="dom-repeat" items="{{routedata}}">
                    <paper-item feature="{{item}}" id="{{item.id}}">
                        {{item.title}}
                    </paper-item>
                </template>
            </paper-listbox>
        </paper-dropdown-menu>
        
    </template>

    <script>

        Polymer({
            is: 'mb-sources-select',

            properties: {
                setupurl: {
                    type: String
                },
                
                routesrc: {
                    type: Object
                },



            },
            //     
            selectRoute : function(e) {
                var selectvalue = e.detail.item[this.selectattr];
                // console.log("selected item:", selectvalue);
                
                if (this.selectattr == "id") this.routeid = selectvalue;
                else this.featureselected = selectvalue;
            },

            /**
            * Put selected src from menu-selection into import-element
            */
            selectRouteSet : function(e) {
                this.routesrc = e.detail.item.src;
            },

            // eval the response of content-list 
            loadRouteSetIndex : function(ajaxresponse) {
                this.routesets = ajaxresponse.detail.response;
            }

        })
    </script>
</dom-module>