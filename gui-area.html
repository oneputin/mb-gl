<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-flex-layout/iron-flex-layout.html">

<link rel="import" href="../paper-icon-button/paper-icon-button.html">

<link rel="import" href="../iron-collapse/iron-collapse.html">

<link rel="import" href="../iron-icons/iron-icons.html">

<link rel="import" href="../paper-button/paper-button.html">


<!--
`gui-area`
container for toggling between FAB(or BUTTON) and an AREA with slots (CARD or other DIV) for variable content

@demo demo/imagelinks.html 
-->

<dom-module id="gui-area">

    <template>

        <style>

            :host {
                display: block;
                position: absolute;
                right: 5px;
                top: 5px;
            }

            #container {
                display: block;
                background-color: rgba(255,255,255,0.5); /*#ff4081*/
                @apply(--layout-vertical);
            }

            paper-icon-button {
                background-color: rgba(255,0,0,0.5);
            }

            .areactrls {
                @apply(--layout-horizontal);
                @apply(--layout-justified);
            }

            .flexchild {
                @apply(--layout-flex);
            }

            .red {
                color: red;
                text-align: center;
                vertical-align: middle;
                height: 100%;
            }

            #chart {
                width: 100%;
                height: 100%;
            }

            #fab {
                opacity: 0.8;    
                min-width: 2em;             
            }

            #handle {
                background-color: white;
                border-color: gray;
                border-style: solid;
                border-width: 1px 1px 1px 1px;
                font-weight: bold;
                min-width: 2em;
                margin-left: 0;
                height: 40px;
                padding: 5px;
            }


            #ctrl div {
                padding-left: 10px;
                padding-bottom: 5px;
                color: white;
                background-color: black;
                font-family: Verdana, Geneva, sans-serif;
            }

            #content {
                padding: 5px;
            }


        </style>

         <!--"FAB" or FAB-Area are visible alternatively -->

        <template is="dom-if" if="{{!open}}">
            <paper-button 
                id = "handle" 
                icon = "explore" 
                title = "tools" 
                on-tap = "_toggleVisibility">v
            </paper-button>
        </template>

        <template is="dom-if" if="{{open}}">

            <!-- "FAB AREA" = vertical container -->
            <div id="container">

                <div class="areactrls">

                    <paper-icon-button icon="unfold-more" on-click="_toggle"></paper-icon-button>
                    
                    <button id="ctrlbtn" on-click="toggleAbout">[[ctrllabel]]</button>
                    <!--<div class="flexchild"></div>-->
                    <paper-icon-button icon="close" on-click="_closer"></paper-icon-button>

                </div>

                <iron-collapse id="ctrl">
                    <content select=".ctrl"></content>
                </iron-collapse>

                <div id="content">
                    <content select=".content"></content>
                </div>    
            </div>
        
        </template>

    </template>

    
    <script>
        
        Polymer({
            is: 'gui-area',

            properties: {

                ctrllabel : {
                    type: String,
                    value: "CTRL"
                }, 

                ctrldisable : {
                    type: Boolean,
                    value: false,
                    observer: 'toggleCtrl'
                }, 

                minsize : {
                    type: Number,
                    value: 200
                },

                maxsize : {
                    type: Number,
                    value: 600
                },

                _issized: {
                    type: Boolean,
                    value : false,
                    observer : '_toggleSize'
                },

                disable: {
                    type: Boolean
                },

                open: {
                    type: Boolean,
                    notify: true,
                    observer: 'logchecked'
                }
            },

            behaviors: [
            ],           

            observers: [
            ],

            ready : function() {
                this._closer();
            },

            logchecked : function(open) { console.log("fabarea logchecked", open);
                if (open === null) return;  
                this._toggleVisibility(open);
            },

            // 
            toggleCtrl : function(disable) { 
                var btn = this.$$('#ctrlbtn'); // console.log("ctrldisable", disable, btn);
                if (btn) btn.disabled = disable;
            },

            attached: function() {
                this._toggleSize(50); 
                var w = Polymer.dom(this).parentNode.offsetWidth; // console.log(w);// window.innerWidth
                this.maxsize = w * 0.8; // + "px"; // 80vw"; // window.innerWidth * 0.8 
            },

            forceView: function(id) {
                // triggers show of viewer-area
                // usable to "remove" the browser-header
                this.open = true;
                this._toggleVisibility(true);
            },

            // 
            toggleAbout: function() {
                // var html = "<h5>Some statistics</h5>";
                // var html = this.logdata.html; // console.log("collapse content", html)
                // this.$$('#ctrl div').innerHTML = html;
                this.$$('#ctrl').toggle();
            },

            _closer : function() {
                // this.open = false;
                this._toggleVisibility(false); 
                this._issized = false;
            },

            _toggle : function() {
                this._issized = !this._issized;
            },

            _toggleSize: function(size) { 
                // debounce to enable _issized-flipflop
                var gchrt = this.$$("google-chart"); 
                if (!gchrt) return; 
                 
                this.debounce("size", function(){ // console.log("TOGGLESIZE", typeof size, size,  this._issized); // , typethis.chartoptions);                 
                    if (typeof size == "number") {
                        // use this size for chart
                    } else if (!this._issized) {
                        size = this.minsize;
                    } else {
                        size = this.maxsize;
                    }

                    this.set('chartoptions.width', size);
                    this.set('chartoptions.height', size);
                }, 50);
            },    

            // alternative visibility of control and container
            _toggleVisibility: function(flag) {                
                if (flag == null) flag = !this.open; 
                if (!flag)  {
                    this._toggleSize(50);
                } else {
                    this._issized = true;
                    this._issized = false;
                }
                this.open = flag;
                return; 
            } 

        });

    </script>

</dom-module>